

<div id="toolbar">
	<a class="easyui-linkbutton" onclick="order_list()">订单管理</a> <a
		class="easyui-linkbutton" onclick="order_num()">订单分析</a> <a
		class="easyui-linkbutton" onclick="order_map()">买家地图</a>
</div>
<style>
#listOrder, #ordernum, #map1 {
	width: 100%;
	height: 490px;
}
</style>

<div id="listOrder">

	<table id="listOrder_dataInfo"></table>

	<!-- 工具栏 -->
	<div id="order_search">
		<div class="datagrid-btn-separator"></div>
		<label>请选择年：</label><select name="role" id="order_select_year">
			<option value="-1">--请选择--</option>

		</select>&nbsp; <label>请选择月：</label><select name="role" id="order_select_month">
			<option value="-1">--请选择--</option>



		</select>&nbsp; <label>请输入订单编号：</label><input type="text" name="ordernum"
			id="order_select_ordernum" /> <label>请选择状态：</label><select
			name="status" id="order_select_status">
			<option value='-1'>--请选择--</option>
			<option value='0'>已下单</option>
			<option value='1'>已付款</option>
			<option value='2'>已消费</option>
		</select> &nbsp;&nbsp;<a href="javascript:search_orderInfo()"
			class="easyui-linkbutton" data-options="iconCls:'icon-search'">查找</a>
	</div>

</div>
<div id="ordernum" >
     	<center><h3>订单量与访问量的月度报表(x轴:月份,y轴:数量)<h3></h3></center>
		<div id="main" style="height:450px;width:1200px;border:1px solid #ccc;padding:10px;"></div>
    	
		
</div>
<div id="map1">

	<div id="mainMap" style="height:490px;width:1200px;border:1px solid #ccc;padding:10px;"></div>
</div>


<script>
  
  
  
 	function order_list(){
 		$("#listOrder").show();
 		$("#ordernum").hide();
 		$("#map1").hide();
 		
 	}
 	
 	function order_num(){
 		$("#listOrder").hide();
 		$("#ordernum").show();
 		$("#map1").hide();
 		
 		
 		findData();
 		
 		
 		setTimeout(function(){
 			cc();
				
 		},500);

 	}
 	
 	function order_map(){
 		$("#listOrder").hide();
 		$("#ordernum").hide();
 		$("#map1").show();
 		
 		findprov();
 		alert();
 		alert(datamap);
 		cc();
 	}
   
   
 	
 	//---------------------------------------第一个div
 	$(function(){
 		order_list();
 		
 		var year=document.getElementById("order_select_year");
		var month=document.getElementById("order_select_month");
 		var y = new Date().getFullYear();
		for(var i =y;i>(y-10); i--){
			year.options.add( new Option(i,"")  );
		}
		for(var i=1;i<13;i++){
			month.options.add( new Option(i,"")  );
		}
 		
 		
		$('#listOrder_dataInfo')
		.datagrid(
				{
					url : '../../servlet/orderServlet',
					queryParams : {
						op : "findOrdersByPage"
					},
					loadMsg : "数据加载中",
					fitColumns : true,
					striped : true,
					nowrap : true,
					pagination : true,
					fit : true,
					rownumbers : true,
					pageList : [ 2, 4, 10 ],
					pageSize : 4,
					sortName : "stime",
					remoteSort : false,
					columns : [ [
					     	{
									field : 'pic',
									title : '图像',
									width : 80,
									align : 'center',
									formatter : function(value, row, index) {
										if (value == "") {
											return "<img src='../../images/zanwu.jpg'  width='100px'  height='100px'  />";
										} else {
											return "<img src='../../"+value+"'  width='100px'  height='100px'  />";
										}
									}
							},
							{
								field : 'ordernum',
								title : '订单编号',
								width : 130,
								align : 'center',
								sortable : true
							},
							{
								field : 'gname',
								title : '商品名',
								width : 100,
								align : 'center'
							},
							{
								field : 'nums',
								title : '数量',
								width : 80,
								align : 'center'
							},
							{
								field : 'usid',
								title : '买家编号',
								width : 80,
								align : 'center'
							},
							{
								field : 'price',
								title : '价格',
								width : 80,
								align : 'center'
							},
							{
								field : 'stime',
								title : '下单时间',
								width : 100,
								align : 'center'
							},
							{
								field : 'statusStr',
								title : '订单状态',
								width : 80,
								align : 'center'
							},
							{
								field : '_operate',
								title : '操作',
								width : 100,
								align : 'center',
								formatter : function(val, row, index) {
									return "&nbsp;&nbsp;<a href='javascript:delteOrderInfo("+row.ordernum+")' class='icon-remove1  icon-padding' >删除订单</a>"
											+ "<a href='javascript:updateOrderInfo("+row.ordernum+")' class='icon-edit1  icon-padding'>发货</a> ";
								}
							}

					] ],
					toolbar : "#order_search"

				});
		
 	});
 	
 	
 	
 	
 	function delteOrderInfo(ordernum){
 		

		if(ordernum!=null){
			
			$.messager.confirm('确认删除么','确认删除么',function(rt){
				 if(rt){
			 		$.post("../../servlet/orderServlet",{op:"deleteorderstype",ordernum:ordernum},function(data){
					data=parseInt($.trim(data));

					if(data>0){
						$.messager.show({title:'温馨提示',msg:'删除成功',timeout:2000,showType:'slide'});
						$('#listOrder_dataInfo').datagrid("reload");
					}else{
						$.messager.alert('失败','删除失败','error');   
					}
				}); 
			   }
			});	 
			 		
		}
 	}
 	
 	
 	function updateOrderInfo(ordernum){
 		

		if(ordernum!=null){
			
				 $.post("../../servlet/orderServlet",{op:"updateorderInfo",ordernum:ordernum},function(data){
						data=parseInt($.trim(data));

						if(data>0){
							$.messager.show({title:'温馨提示',msg:'发货成功',timeout:2000,showType:'slide'});
							$('#listOrder_dataInfo').datagrid("reload");
						}else{
							$.messager.alert('失败','发货失败','error');   
						}
					}); 
					 
		}
 	}
 	
 	function search_orderInfo(){
 		var year=$("#order_select_year   option:selected").text();
		var month=$("#order_select_month  option:selected").text();
		var ordernum=$("#order_select_ordernum").val();
		var status=$("#order_select_status").val();
		

		$('#listOrder_dataInfo').datagrid({
			url:'../../servlet/orderServlet',
			queryParams:{op:"searchOrdersByPage",year:year,month:month,ordernum:ordernum,status:status}
		});
 		
 		
 	}
 	
 	</script>
 	
 	
 	<script>
 	
 	
 	
 	var monthdata=[];  //设置月份
 	var datac=[];   //设置下单量
 	var datal=[];   //设置浏览量
 	
 	//查找下单数和成交数
 		function findData(){
 			
 			var myDate = new Date();
 			var year=myDate.getFullYear();;        //获取当前年份(2位)
 		
 			$.post("../../servlet/orderServlet",{op:"findData",year:year},function(data){

				$.each(data,function(i,item){
					monthdata[i]=item.month+"月";
					datac[i]=item.count;
					datal[i]=item.count*8;
				});
				
				
			},"json"); 
 			
 		}
 	
 	
 	var datamap=[];
 	
 	//查找用户的省份信息
 	function findprov(){
 		
 			var myDate = new Date();
			var year=myDate.getFullYear();        //获取当前年份(2位)
		
			$.post("../../servlet/orderServlet",{op:"findprov",year:year},function(data){
				 /* {name: '北京',value: Math.round(Math.random()*1000)}, */
			 $.each(data,function(i,item){
				 alert(item.prov);
				 alert(item.count);
				datamap[i]={name:item.prov,value:item.count}
				alert(datamap[i]);
			}); 
			
			
		},"json"); 
 		
 	}
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	</script>
 	
 	
 	
 	
 	
 	
 	
 	
 
 	
 	<script src="../echarts/echarts.js"></script>
 	<script type="text/javascript">
 
 	//var data3=[2.0, 4.9];
 	//var data4=[2.6, 5.9];
 	// ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月']
 	
 	function cc(){
 
    require.config({
        paths: {
            echarts: '../echarts'
        }
    });
    
    require(
        [
            'echarts',
            'echarts/chart/bar',
            'echarts/chart/line',
            'echarts/chart/map'
        ],
        function (ec) {
            //--- 折柱 ---
            var myChart = ec.init(document.getElementById('main'));
            
            myChart.setOption({
                tooltip : {
                    trigger: 'axis'
                },
                legend: {
                    data:['下单量','访问量']
                },
                toolbox: {
                    show : true,
                    feature : {
                        mark : {show: true},
                        dataView : {show: true, readOnly: false},
                        magicType : {show: true, type: ['line', 'bar']},
                        restore : {show: true},
                        saveAsImage : {show: true}
                    }
                },
                calculable : true,
                xAxis : [
                    {
                        type : 'category',
                        data : monthdata 
                    }
                ],
                yAxis : [
                    {
                        type : 'value',
                        splitArea : {show : true}
                    }
                ],
                series : [
                    {
                        name:'下单量',
                        type:'bar',
                        data:datac
                    },
                    {
                        name:'访问量',
                        type:'bar',
                        data:datal
                    }
                ]
            });
            
            // --- 地图 ---
            var myChart2 = ec.init(document.getElementById('mainMap'));
            myChart2.setOption({
            		    title : {
            		        text: '商品销量',
            		        subtext: '纯属虚构',
            		        x:'center'
            		    },
            		    tooltip : {
            		        trigger: 'item'
            		    },
            		    legend: {
            		        orient: 'vertical',
            		        x:'left',
            		        data:['本店商品']
            		    },
            		    dataRange: {
            		        min: 0,
            		        max: 100,
            		        x: 'left',
            		        y: 'bottom',
            		        text:['高','低'],           // 文本，默认为数值文本
            		        calculable : true
            		    },
            		    toolbox: {
            		        show: true,
            		        orient : 'vertical',
            		        x: 'right',
            		        y: 'center',
            		        feature : {
            		            mark : {show: true},
            		            dataView : {show: true, readOnly: false},
            		            restore : {show: true},
            		            saveAsImage : {show: true}
            		        }
            		    },
            		    roamController: {
            		        show: true,
            		        x: 'right',
            		        mapTypeControl: {
            		            'china': true
            		        }
            		    },
            		    series : [
            		        {
            		            name: '本店商品数量',
            		            type: 'map',
            		            mapType: 'china',
            		            roam: false,
            		            itemStyle:{
            		                normal:{label:{show:true}},
            		                emphasis:{label:{show:true}}
            		            },
            		            data:datamap
            		        }
            		    ]
            	
        
            });
        }
    );
    
 	}
 	
 	
 	
 	
	
    /* tooltip : {
        trigger: 'item',
        formatter: '{b}'
    },
    series : [
        {
            name: '中国',
            type: 'map',
            mapType: 'china',
            selectedMode : 'multiple',
            itemStyle:{
                normal:{label:{show:true}},
                emphasis:{label:{show:true}}
            },
            data:[
                {name:'湖南',value:4,selected:true}
            ]
        }
    ] */
 	
 	
 	
 	
 	
 	
    </script>





